static_dir = "./static/"
log_dir = "logs/moshi-server-rust/tts"
# Used to identify the server when logging.
instance_name = "config-tts-realtime"
# Authentication is handled by Better Auth JWT (BETTER_AUTH_SECRET env var)
authorized_ids = []

[modules.tts]
type = "Tts"
# Under which path should the TTS be available?
path = "/api/tts_streaming"

# Model files from Hugging Face
lm_model_file = "hf://kyutai/tts-1.6b-en_fr/dsm_tts_1e68beda@240.safetensors"
text_tokenizer_file = "hf://kyutai/tts-1.6b-en_fr/tokenizer_spm_8k_en_fr_audio.model"
# Speaker tokenizer - empty string = use embedded mimi from lm_model_file
speaker_tokenizer_file = ""
audio_tokenizer_file = "hf://kyutai/tts-1.6b-en_fr/tokenizer-e351c8d8-checkpoint125.safetensors"

# Directory for voice files (supports hf-snapshot:// for HF repos with glob patterns)
voice_dir = "hf-snapshot://kyutai/tts-voices/**/*.safetensors"

# Whether to log token generation (useful for debugging)
log_tokens = false

# Preloaded voices (name = path to safetensors file)
[modules.tts.voices]
# Add preloaded voices here if needed

# LM Model configuration for TTS (1.6B model)
# Uses 8 codebooks for faster realtime inference (vs 16 for quality)
[modules.tts.model]
text_in_vocab_size = 8001
text_out_vocab_size = 8000
audio_vocab_size = 2049
audio_codebooks = 8

[modules.tts.model.transformer]
d_model = 2048
num_heads = 16
num_layers = 16
dim_feedforward = 8192
causal = true
norm_first = true
bias_ff = false
bias_attn = false
context = 3000
max_period = 100000
use_conv_block = false
use_conv_bias = true
gating = "silu"
norm = "RmsNorm"
positional_embedding = "Rope"
conv_layout = false
conv_kernel_size = 3
kv_repeat = 1
max_seq_len = 4096

[modules.tts.model.depformer]
num_slices = 8

[modules.tts.model.depformer.transformer]
d_model = 1024
num_heads = 16
num_layers = 6
dim_feedforward = 4096
causal = true
norm_first = true
bias_ff = false
bias_attn = false
context = 32
max_period = 10000
use_conv_block = false
use_conv_bias = true
gating = "silu"
norm = "RmsNorm"
positional_embedding = "None"
conv_layout = false
conv_kernel_size = 3
kv_repeat = 1
max_seq_len = 4096

# Speaker conditioning (description quality) - optional
[modules.tts.model.conditioners.description]
type = "Lut"
n_bins = 31
dim = 16
possible_values = ["very_bad", "bad", "neutral", "good", "very_good"]

# TTS Generation configuration
[modules.tts.generation]
acoustic_delay = 2
text_pad_token = 3
text_bos_token = 1
text_eos_token = 2
text_eop_token = 0
text_start_token = 8000
text_audio_delay_in_tokens = 25
max_consecutive_pads = 10
extra_steps = 5
speaker_cond_duration_s = 10.0
speaker_cond_dim = 2048
speaker_cond_n_speakers = 5
